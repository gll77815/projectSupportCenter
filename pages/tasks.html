<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>履约协同平台 - 任务大厅</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        indigo: { 50: '#eef2ff', 500: '#6366f1', 600: '#4f46e5' },
                        slate: { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 800: '#1e293b' }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F4F7FE; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .page-section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* 导航选中样式 */
        .nav-item.active { background-color: #eef2ff; color: #4f46e5; border-right: 3px solid #4f46e5; }
        .center-nav.active { background-color: #eef2ff; color: #4f46e5; font-weight: 600; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }

        /* 抽屉动画 - 改为从右侧划出 */
        .drawer { transform: translateX(100%); transition: transform 0.3s ease-in-out; }
        .drawer.open { transform: translateX(0); }
        
        /* 慢速旋转动画 */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow { animation: spin-slow 3s linear infinite; }
        
        /* 卡片悬停动画 */
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        
        /* 按钮交互效果 */
        .btn-primary { transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3); }
        
        /* 平滑滚动 */
        html { scroll-behavior: smooth; }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .sidebar { width: 240px; }
            .main-content { margin-left: 240px; }
            .grid-cols-3 { grid-template-columns: 1fr; }
            .grid-cols-2 { grid-template-columns: 1fr; }
            
            /* 工作项卡片响应式 */
            .work-item-card { grid-template-columns: 1fr; }
            
            /* 表单按钮响应式 */
            .form-actions { position: static; margin-top: 20px; justify-content: center; }
            
            /* 弹窗响应式 */
            #workItemModal .max-w-4xl { max-width: 95vw; }
            #workItemModal table { font-size: 12px; }
            #workItemModal th, #workItemModal td { padding: 8px; }
        }
        
        /* 加载动画 */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        
        /* 进度条动画 */
        @keyframes progress {
            from { width: 0%; }
            to { width: var(--progress-width, 100%); }
        }
        .progress-animate { animation: progress 1.5s ease-out forwards; }
        
        /* 标签动画 */
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .slide-in { animation: slideIn 0.5s ease-out forwards; }
        
        /* 微交互效果 */
        .interactive { transition: all 0.2s ease; }
        .interactive:hover { cursor: pointer; }
        
        /* 表格行悬停效果 */
        table tbody tr:hover { background-color: #f8fafc; }
        
        /* 表单元素焦点效果 */
        input:focus, select:focus, textarea:focus { outline: none; ring: 2px; ring-color: #6366f1; ring-opacity: 0.5; }
        
        /* 卡片选中状态 - 统一所有卡片的选中视觉效果 */
        .card-selected {
            border-color: #4f46e5 !important; /* 选中时的边框颜色 */
            background-color: #f8faff !important; /* 选中时的背景色 */
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1) !important; /* 选中时的边框阴影效果 */
            transition: all 0.3s ease !important; /* 平滑过渡效果 */
        }
    </style>
    <script>
        // 初始化Lucide图标
        lucide.createIcons();

        // 页面加载完成后生成默认任务项卡片
        document.addEventListener('DOMContentLoaded', function() {
            generateDefaultWorkItemCard();
            // 初始化子任务执行按钮的显示状态
            initializeSubtaskExecuteButtons();
            // 初始化态势卡片点击事件
            initializeStatusCards();
            // 计算并显示"我的任务"数量
            updateMyTasksCount();
        });

        // 初始化子任务执行按钮的显示状态
        function initializeSubtaskExecuteButtons() {
            // 模拟当前登录用户
            const currentUser = '张经理';
            
            // 获取所有子任务区域
            const subtasks = document.querySelectorAll('.p-4.bg-slate-50');
            
            subtasks.forEach((subtask, index) => {
                // 获取支持人员信息
                const supportPersonElement = subtask.querySelector('.grid.grid-cols-2.gap-2:nth-child(1) .font-medium.text-slate-800');
                if (supportPersonElement) {
                    const supportPerson = supportPersonElement.textContent.trim();
                    
                    // 获取按钮容器
                    const buttonContainer = subtask.querySelector('.absolute.top-4.right-4.flex.gap-2');
                    if (buttonContainer) {
                        // 获取所有按钮
                        const executeButtons = buttonContainer.querySelectorAll('.bg-indigo-100.text-indigo-600');
                        const remindButtons = buttonContainer.querySelectorAll('.bg-yellow-100.text-yellow-600');
                        const transferButtons = buttonContainer.querySelectorAll('.bg-blue-100.text-blue-600');
                        
                        // 仅当子任务负责人是当前登录用户时显示完成服务和进度上报按钮
                        if (supportPerson === currentUser) {
                            // 显示完成服务和进度上报按钮
                            executeButtons.forEach(button => {
                                button.style.display = 'inline-block';
                            });
                            // 隐藏催办和转派按钮
                            remindButtons.forEach(button => {
                                button.style.display = 'none';
                            });
                            transferButtons.forEach(button => {
                                button.style.display = 'none';
                            });
                        } else {
                            // 非本人时，保持原有按钮显示状态
                            executeButtons.forEach(button => {
                                button.style.display = 'none';
                            });
                            remindButtons.forEach(button => {
                                button.style.display = 'inline-block';
                            });
                            transferButtons.forEach(button => {
                                button.style.display = 'inline-block';
                            });
                        }
                    }
                }
            });
        }

        // 生成默认任务项卡片
        function generateDefaultWorkItemCard() {
            const container = document.getElementById('workItemCards');
            const defaultItem = {
                id: 0,
                name: '请选择任务项',
                center: '设计中心',
                level1: '图纸设计'
            };
            
            const cardWrapper = document.createElement('div');
            cardWrapper.className = 'flex items-start gap-4 mb-4';
            cardWrapper.dataset.default = 'true';
            
            const card = document.createElement('div');
            card.className = 'flex-1 border border-slate-200 rounded-xl p-4 bg-blue-50 shadow-sm work-item-card';
            card.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">支持中心</label>
                        <select class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100">
                            <option value="设计中心" ${defaultItem.center === '设计中心' ? 'selected' : ''}>设计中心</option>
                            <option value="技术中心" ${defaultItem.center === '技术中心' ? 'selected' : ''}>技术中心</option>
                            <option value="商务中心" ${defaultItem.center === '商务中心' ? 'selected' : ''}>商务中心</option>
                            <option value="供应链中心" ${defaultItem.center === '供应链中心' ? 'selected' : ''}>供应链中心</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">职能类型</label>
                        <select class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100">
                            <option value="${defaultItem.level1}" selected>${defaultItem.level1}</option>
                            <option>图纸设计</option>
                            <option>技术支持</option>
                            <option>商务谈判</option>
                            <option>材料采购</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">任务项名称</label>
                        <input type="text" value="${defaultItem.name}" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100">
                    </div>

                    
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">任务时限</label>
                        <input type="date" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">评估产值 (元)</label>
                        <input type="number" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100" placeholder="0">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-slate-700 mb-2">内容描述</label>
                    <textarea rows="4" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100" placeholder="请详细描述需求内容..."></textarea>
                </div>
            `;
            
            container.appendChild(cardWrapper);
            cardWrapper.appendChild(card);
            
            // 重新渲染图标
            lucide.createIcons();
        }

        // 工作项数据
        const workItems = [
            { id: 1, name: '建筑设计', center: '设计中心', level1: '图纸设计', level2: '建筑设计', mechanism: '专家评审', output: '施工图', timeLimit: '7天' },
            { id: 2, name: '结构计算', center: '技术中心', level1: '技术支持', level2: '结构计算', mechanism: '现场指导', output: '计算书', timeLimit: '5天' },
            { id: 3, name: '合同评审', center: '商务中心', level1: '商务谈判', level2: '合同评审', mechanism: '法务支持', output: '合同文本', timeLimit: '3天' },
            { id: 4, name: '设备询价', center: '供应链中心', level1: '材料采购', level2: '设备询价', mechanism: '集中采购', output: '报价单', timeLimit: '2天' }
        ];

        // 页面导航函数
        function navigateTo(page) {
            window.location.href = page;
        }

        function switchPage(pageId, event) {
            // 阻止事件冒泡，确保按钮点击优先级高于卡片展开
            if (event) {
                event.stopPropagation();
            }
            // 隐藏所有页面
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            // 显示目标页面
            document.getElementById(pageId).classList.add('active');
            // 更新页面标题
            if (pageId === 'tasks') {
                document.getElementById('pageTitle').textContent = '任务大厅';
            } else if (pageId === 'task-report') {
                document.getElementById('pageTitle').textContent = '任务提报';
            } else if (pageId === 'task-detail') {
                document.getElementById('pageTitle').textContent = '任务详情';
            }
        }

        // 打开任务提报页面
        function openTaskReport() {
            switchPage('task-report');
        }

        // 打开个人任务中心
        function openPersonalTaskCenter() {
            alert('打开个人任务中心');
        }

        // 切换组织菜单
        function toggleOrgMenu() {
            const menu = document.getElementById('orgMenu');
            menu.classList.toggle('hidden');
        }

        // 更改组织
        function changeOrg(org) {
            document.getElementById('currentOrg').textContent = org;
            document.getElementById('orgMenu').classList.add('hidden');
        }

        // 切换中心视图
        function switchCenterView(viewName, button) {
            // 更新按钮状态
            document.querySelectorAll('.center-nav').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
            // 更新徽章
            document.getElementById('centerBadge').textContent = viewName;
        }

        // 筛选任务状态
        function filterTasksByStatus(status) {
            console.log('筛选任务状态:', status);
            
            // 获取所有任务项
            const taskItems = document.querySelectorAll('.border.border-slate-100.rounded-xl');
            
            taskItems.forEach(taskItem => {
                // 检查任务的状态是否匹配
                const statusElement = taskItem.querySelector('.bg-orange-50.text-orange-600.text-xs.rounded, .bg-indigo-50.text-indigo-600.text-xs.rounded, .bg-green-50.text-green-600.text-xs.rounded, .bg-yellow-50.text-yellow-600.text-xs.rounded');
                if (statusElement && statusElement.textContent.trim() === status) {
                    // 显示匹配的任务
                    taskItem.style.display = 'block';
                } else {
                    // 隐藏不匹配的任务
                    taskItem.style.display = 'none';
                }
            });
        }

        // 初始化态势卡片点击事件
        function initializeStatusCards() {
            // 获取所有态势卡片
            const statusCards = document.querySelectorAll('#myTasksCard, [data-filter]');
            
            statusCards.forEach(card => {
                card.addEventListener('click', function() {
                    // 检查当前卡片是否已选中
                    const isCurrentlySelected = this.classList.contains('card-selected');
                    
                    // 先移除所有卡片的选中状态
                    statusCards.forEach(c => c.classList.remove('card-selected'));
                    
                    // 如果当前卡片未选中，则添加选中状态
                    if (!isCurrentlySelected) {
                        this.classList.add('card-selected');
                        
                        // 执行筛选逻辑
                        if (this.id === 'myTasksCard') {
                            // 筛选"我的任务"
                            filterMyTasks();
                        } else {
                            // 筛选其他状态
                            const filterStatus = this.getAttribute('data-filter');
                            filterTasksByStatus(filterStatus);
                        }
                    } else {
                        // 取消筛选，显示所有任务
                        showAllTasks();
                    }
                });
            });
        }

        // 计算并显示"我的任务"数量
        function updateMyTasksCount() {
            // 模拟计算张经理的任务数
            // 实际项目中应该从任务列表中统计
            const myTasksCount = 8; // 假设张经理有8个任务
            document.getElementById('myTasksCount').textContent = myTasksCount;
        }

        // 筛选"我的任务"
        function filterMyTasks() {
            // 获取所有任务项
            const taskItems = document.querySelectorAll('.border.border-slate-100.rounded-xl');
            
            taskItems.forEach(taskItem => {
                // 检查任务的支持人员是否为"张经理"
                const supportPersonElement = taskItem.querySelector('.grid.grid-cols-2.gap-2:nth-child(2) .font-medium.text-slate-800');
                if (supportPersonElement && supportPersonElement.textContent.trim() === '张经理') {
                    // 显示匹配的任务
                    taskItem.style.display = 'block';
                } else {
                    // 隐藏不匹配的任务
                    taskItem.style.display = 'none';
                }
            });
        }

        // 显示所有任务
        function showAllTasks() {
            // 获取所有任务项
            const taskItems = document.querySelectorAll('.border.border-slate-100.rounded-xl');
            
            // 显示所有任务
            taskItems.forEach(taskItem => {
                taskItem.style.display = 'block';
            });
        }

        // 切换子任务显示
        function toggleSubtasks(taskId) {
            const subtasks = document.getElementById(taskId + 'Subtasks');
            const icon = document.getElementById(taskId + 'Icon');
            if (subtasks.classList.contains('hidden')) {
                subtasks.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                subtasks.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // 工作项选择弹窗
        function openWorkItemModal() {
            document.getElementById('workItemModal').classList.remove('hidden');
        }

        function closeWorkItemModal() {
            document.getElementById('workItemModal').classList.add('hidden');
        }

        // 确认工作项选择
        function confirmWorkItemSelection() {
            const selectedItems = [];
            document.querySelectorAll('.workItemCheckbox:checked').forEach(checkbox => {
                const itemId = parseInt(checkbox.value);
                const item = workItems.find(item => item.id === itemId);
                if (item) {
                    selectedItems.push(item);
                }
            });

            if (selectedItems.length > 0) {
                generateWorkItemCards(selectedItems);
            }

            closeWorkItemModal();
        }

        function generateWorkItemCards(items) {
            const container = document.getElementById('workItemCards');
            items.forEach(item => {
                const cardWrapper = document.createElement('div');
                cardWrapper.className = 'flex items-start gap-4 mb-4';
                
                const card = document.createElement('div');
                card.className = 'flex-1 border border-slate-200 rounded-xl p-4 bg-blue-50 shadow-sm work-item-card';
                card.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">支持中心</label>
                            <select class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100">
                                <option value="设计中心" ${item.center === '设计中心' ? 'selected' : ''}>设计中心</option>
                                <option value="技术中心" ${item.center === '技术中心' ? 'selected' : ''}>技术中心</option>
                                <option value="商务中心" ${item.center === '商务中心' ? 'selected' : ''}>商务中心</option>
                                <option value="供应链中心" ${item.center === '供应链中心' ? 'selected' : ''}>供应链中心</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">职能类型</label>
                            <select class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100">
                                <option value="${item.level1}" selected>${item.level1}</option>
                                <option>图纸设计</option>
                                <option>技术支持</option>
                                <option>商务谈判</option>
                                <option>材料采购</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">任务项名称</label>
                            <input type="text" value="${item.name}" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">任务时限</label>
                            <input type="date" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">评估产值 (元)</label>
                            <input type="number" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100" placeholder="0">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-2">内容描述</label>
                        <textarea rows="4" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100" placeholder="请详细描述需求内容..."></textarea>
                    </div>
                `;
                
                const deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.onclick = function() {
                    if (confirm('确定要删除这个任务项吗？')) {
                        removeWorkItemCard(this);
                    }
                };
                deleteButton.className = 'text-red-500 hover:text-red-700 flex-shrink-0 mt-2';
                deleteButton.innerHTML = '<i data-lucide="trash-2" class="w-4 h-4"></i>';
                
                cardWrapper.appendChild(card);
                cardWrapper.appendChild(deleteButton);
                container.appendChild(cardWrapper);
            });

            // 重新渲染图标
            lucide.createIcons();
        }

        // 删除工作项卡片
        function removeWorkItemCard(button) {
            const cardWrapper = button.closest('.flex.items-start.gap-4.mb-4');
            if (cardWrapper) {
                cardWrapper.remove();
            }
        }

        // 更新进度显示
        function updateProgressDisplay() {
            const range = document.getElementById('progressRange');
            const value = document.getElementById('progressValue');
            if (range && value) {
                value.textContent = range.value + '%';
            }
        }

        // 完成任务执行
        function completeTaskExecution() {
            alert('任务执行已完成');
            switchPage('todo-detail');
        }

        // 保存任务进度
        function saveTaskProgress() {
            // 模拟保存操作
            alert('进度保存成功');
            // 保持表单状态为"进行中"，不发生状态变更
            // 保留当前表单内容且不跳转页面
        }

        // 打开待办执行页面
        function openTodoExecution(taskId, taskName, status, assignee, deadline, duration, progress, supportCenter) {
            // 保存任务数据到全局变量
            window.currentTodoTask = {
                id: taskId,
                name: taskName,
                status: status,
                assignee: assignee,
                deadline: deadline,
                duration: duration,
                progress: progress,
                supportCenter: supportCenter
            };
            
            // 切换到待办执行页面
            switchPage('todo-execution');
            
            // 填充待办执行页面数据
            populateTodoExecutionPage();
        }

        // 填充待办执行页面数据
        function populateTodoExecutionPage() {
            const task = window.currentTodoTask;
            if (!task) return;
            
            // 更新页面标题和任务信息
            document.getElementById('executionTaskName').textContent = task.name;
            document.getElementById('executionTaskId').textContent = '任务ID: ' + task.id;
            document.getElementById('executionTaskStatus').textContent = task.status;
            document.getElementById('executionDuration').textContent = task.duration;
            document.getElementById('executionDeadline').textContent = task.deadline;
            document.getElementById('executionAssignee').textContent = task.assignee;
            document.getElementById('executionSupportCenter').textContent = task.supportCenter;
            document.getElementById('executionProgress').textContent = task.progress;
            
            // 更新状态标签样式
            const statusBadge = document.getElementById('executionStatusBadge');
            statusBadge.className = 'px-2 py-1 text-xs rounded';
            
            if (task.status === '待接单') {
                statusBadge.classList.add('bg-orange-50', 'text-orange-600');
            } else if (task.status === '进行中') {
                statusBadge.classList.add('bg-indigo-50', 'text-indigo-600');
            } else if (task.status === '已完成') {
                statusBadge.classList.add('bg-green-50', 'text-green-600');
            } else if (task.status === '已完成未评价') {
                statusBadge.classList.add('bg-yellow-50', 'text-yellow-600');
            }
            
            // 根据操作类型调整界面元素
            const actionType = task.actionType;
            const progressSection = document.getElementById('executionProgressSection');
            const completeButton = document.getElementById('completeExecutionButton');
            
            if (actionType === 'complete') {
                // 完成服务：不显示执行进度相关的反馈信息
                if (progressSection) {
                    progressSection.style.display = 'none';
                }
                // 显示完成执行按钮
                if (completeButton) {
                    completeButton.style.display = 'flex';
                    completeButton.innerHTML = '<i data-lucide="check-circle" class="w-4 h-4"></i> 完成执行';
                    completeButton.onclick = completeTaskExecution;
                }
            } else if (actionType === 'report') {
                // 进度上报：显示执行进度，将完成执行按钮替换为保存按钮
                if (progressSection) {
                    progressSection.style.display = 'block';
                }
                if (completeButton) {
                    completeButton.style.display = 'flex';
                    completeButton.innerHTML = '<i data-lucide="save" class="w-4 h-4"></i> 保存';
                    completeButton.onclick = saveTaskProgress;
                }
            }
        }

        // 保存任务草稿
        function saveTaskDraft() {
            alert('任务草稿已保存');
        }

        // 提交任务提报
        function submitTaskReport() {
            alert('任务已提交审核');
        }

        // 撤回任务
        function withdrawTask() {
            alert('任务已撤回');
        }

        // 放弃任务
        function abandonTask() {
            alert('任务已放弃');
        }

        // 打开待办详情页面
        function openTodoDetail(taskId, taskName, status, assignee, deadline, duration, progress, supportCenter) {
            // 保存任务数据到全局变量
            window.currentTodoTask = {
                id: taskId,
                name: taskName,
                status: status,
                assignee: assignee,
                deadline: deadline,
                duration: duration,
                progress: progress,
                supportCenter: supportCenter
            };
            
            // 切换到待办详情页面
            switchPage('todo-detail');
            
            // 填充待办详情页面数据
            populateTodoDetailPage();
        }

        // 填充待办详情页面数据
        function populateTodoDetailPage() {
            const task = window.currentTodoTask;
            if (!task) return;
            
            // 更新页面标题和任务信息
            document.getElementById('todoTaskName').textContent = task.name;
            document.getElementById('todoTaskId').textContent = task.id;
            document.getElementById('todoTaskStatus').textContent = task.status;
            
            // 更新状态标签样式
            const statusBadge = document.getElementById('todoStatusBadge');
            statusBadge.className = 'px-2 py-1 text-xs rounded';
            
            if (task.status === '待接单') {
                statusBadge.classList.add('bg-orange-50', 'text-orange-600');
            } else if (task.status === '进行中') {
                statusBadge.classList.add('bg-indigo-50', 'text-indigo-600');
            } else if (task.status === '已完成') {
                statusBadge.classList.add('bg-green-50', 'text-green-600');
            } else if (task.status === '已完成未评价') {
                statusBadge.classList.add('bg-yellow-50', 'text-yellow-600');
            }
            
            // 更新任务详情信息
            document.getElementById('todoAssignee').textContent = task.assignee;
            document.getElementById('todoDeadline').textContent = task.deadline;
            document.getElementById('todoDuration').textContent = task.duration;
            document.getElementById('todoProgress').textContent = task.progress;
            document.getElementById('todoSupportCenter').textContent = task.supportCenter;
        }

        // 打开任务审批页面
        function openTaskApproval(taskId, taskName, status, assignee, deadline, duration, progress, supportCenter, event) {
            // 阻止事件冒泡
            if (event) {
                event.stopPropagation();
            }
            // 保存任务数据到全局变量
            window.currentApprovalTask = {
                id: taskId,
                name: taskName,
                status: status,
                assignee: assignee,
                deadline: deadline,
                duration: duration,
                progress: progress,
                supportCenter: supportCenter
            };
            
            // 切换到任务审批页面
            switchPage('task-approval');
            
            // 填充审批页面数据
            populateTaskApprovalPage();
        }

        // 填充任务审批页面数据
        function populateTaskApprovalPage() {
            const task = window.currentApprovalTask;
            if (!task) return;
            
            // 更新页面标题和任务信息
            document.getElementById('approvalTaskName').textContent = task.name;
            document.getElementById('approvalTaskId').textContent = '任务ID: ' + task.id;
            document.getElementById('approvalTaskStatus').textContent = task.status;
            
            // 更新状态标签样式
            const statusBadge = document.getElementById('approvalStatusBadge');
            statusBadge.className = 'px-2 py-1 text-xs rounded';
            
            if (task.status === '待审批') {
                statusBadge.classList.add('bg-blue-50', 'text-blue-600');
            }
            
            // 更新任务详情信息
            document.getElementById('approvalDuration').textContent = task.duration;
            document.getElementById('approvalDeadline').textContent = task.deadline;
            document.getElementById('approvalSupportCenter').textContent = task.supportCenter;
            document.getElementById('approvalAssignee').textContent = task.assignee;
            document.getElementById('approvalProgress').textContent = task.progress;
            
            // 自动获取审批人信息和审批时间
            document.getElementById('approverName').textContent = '张经理';
            const now = new Date();
            const approvalTime = now.getFullYear() + '/' + 
                                String(now.getMonth() + 1).padStart(2, '0') + '/' + 
                                String(now.getDate()).padStart(2, '0') + ' ' + 
                                String(now.getHours()).padStart(2, '0') + ':' + 
                                String(now.getMinutes()).padStart(2, '0');
            document.getElementById('approvalTime').textContent = approvalTime;
        }

        // 提交审批
        function submitApproval() {
            const approvalResult = document.querySelector('input[name="approvalResult"]:checked');
            const approvalComment = document.getElementById('approvalComment').value;
            
            if (!approvalResult) {
                alert('请选择审批结果');
                return;
            }
            
            alert('审批已提交，结果：' + (approvalResult.value === 'approve' ? '通过' : '不通过'));
            switchPage('tasks');
        }

        // 打开任务分解页面
        function openTaskDecomposition(taskId, taskName, status, assignee, deadline, duration, progress, supportCenter, event) {
            // 阻止事件冒泡
            if (event) {
                event.stopPropagation();
            }
            // 保存任务数据到全局变量
            window.currentDecompositionTask = {
                id: taskId,
                name: taskName,
                status: status,
                assignee: assignee,
                deadline: deadline,
                duration: duration,
                progress: progress,
                supportCenter: supportCenter
            };
            
            // 切换到任务提报页面（用于任务分解）
            switchPage('task-report');
            
            // 填充分解页面数据
            populateTaskDecompositionPage();
        }

        // 填充任务分解页面数据
        function populateTaskDecompositionPage() {
            const task = window.currentDecompositionTask;
            if (!task) return;
            
            // 确保页面已经切换到任务提报页面
            setTimeout(() => {
                // 自动填充任务提报表单的逻辑
                const workItemCards = document.getElementById('workItemCards');
                if (workItemCards) {
                    // 清空现有卡片，只保留默认卡片
                    const existingCards = workItemCards.querySelectorAll('.flex.items-start.gap-4.mb-4');
                    existingCards.forEach((card, index) => {
                        if (index > 0) {
                            card.remove();
                        }
                    });
                    
                    // 获取默认卡片
                    const defaultCard = workItemCards.querySelector('.flex.items-start.gap-4.mb-4');
                    if (defaultCard) {
                        // 添加卡片淡入动画
                        defaultCard.style.opacity = '0';
                        defaultCard.style.transform = 'translateY(10px)';
                        defaultCard.style.transition = 'all 0.5s ease-out';
                        
                        // 填充支持中心
                        const supportCenterSelect = defaultCard.querySelector('select');
                        if (supportCenterSelect) {
                            for (let i = 0; i < supportCenterSelect.options.length; i++) {
                                if (supportCenterSelect.options[i].value === task.supportCenter) {
                                    supportCenterSelect.selectedIndex = i;
                                    break;
                                }
                            }
                        }
                        
                        // 填充职能类型
                        const functionTypeSelect = defaultCard.querySelectorAll('select')[1];
                        if (functionTypeSelect) {
                            // 根据支持中心设置默认职能类型
                            let defaultFunctionType = '';
                            switch (task.supportCenter) {
                                case '设计中心':
                                    defaultFunctionType = '图纸设计';
                                    break;
                                case '技术中心':
                                    defaultFunctionType = '技术支持';
                                    break;
                                case '商务中心':
                                    defaultFunctionType = '商务谈判';
                                    break;
                                case '供应链中心':
                                    defaultFunctionType = '材料采购';
                                    break;
                            }
                            
                            for (let i = 0; i < functionTypeSelect.options.length; i++) {
                                if (functionTypeSelect.options[i].value === defaultFunctionType) {
                                    functionTypeSelect.selectedIndex = i;
                                    break;
                                }
                            }
                        }
                        
                        // 填充任务项名称
                        const taskNameInput = defaultCard.querySelector('input[type="text"]');
                        if (taskNameInput) {
                            taskNameInput.value = task.name;
                        }
                        
                        // 填充任务时限
                        const taskDeadlineInput = defaultCard.querySelector('input[type="date"]');
                        if (taskDeadlineInput) {
                            // 计算任务截止日期
                            const deadlineParts = task.deadline.split('/');
                            if (deadlineParts.length === 3) {
                                const deadlineDate = new Date(deadlineParts[0], deadlineParts[1] - 1, deadlineParts[2]);
                                taskDeadlineInput.valueAsDate = deadlineDate;
                            }
                        }
                        
                        // 填充评估产值
                        const evaluationValueInput = defaultCard.querySelectorAll('input[type="number"]')[0];
                        if (evaluationValueInput) {
                            // 根据任务名称和支持中心设置默认产值
                            let defaultEvaluationValue = 0;
                            switch (task.supportCenter) {
                                case '设计中心':
                                    defaultEvaluationValue = 30000;
                                    break;
                                case '技术中心':
                                    defaultEvaluationValue = 25000;
                                    break;
                                case '商务中心':
                                    defaultEvaluationValue = 20000;
                                    break;
                                case '供应链中心':
                                    defaultEvaluationValue = 15000;
                                    break;
                            }
                            evaluationValueInput.value = defaultEvaluationValue;
                        }
                        
                        // 填充内容描述
                        const descriptionTextarea = defaultCard.querySelector('textarea');
                        if (descriptionTextarea) {
                            descriptionTextarea.value = `任务分解：${task.name}\n原任务状态：${task.status}\n原任务负责人：${task.assignee}\n原任务截止时间：${task.deadline}\n原任务时限：${task.duration}\n原任务进度：${task.progress}`;
                        }
                        
                        // 触发卡片动画
                        setTimeout(() => {
                            defaultCard.style.opacity = '1';
                            defaultCard.style.transform = 'translateY(0)';
                        }, 100);
                        
                        // 为表单字段添加逐个显示的动画
                        const formFields = defaultCard.querySelectorAll('select, input, textarea');
                        formFields.forEach((field, index) => {
                            field.style.opacity = '0';
                            field.style.transform = 'translateX(-5px)';
                            field.style.transition = 'all 0.3s ease-out';
                            
                            setTimeout(() => {
                                field.style.opacity = '1';
                                field.style.transform = 'translateX(0)';
                            }, 150 + (index * 50));
                        });
                    }
                }
            }, 100);
        }

        // 打开任务评价页面
        function openTaskEvaluation(taskId, taskName, status, assignee, deadline, duration, progress, supportCenter, event) {
            // 阻止事件冒泡
            if (event) {
                event.stopPropagation();
            }
            
            // 使用URL参数传递任务信息到评价页面
            const params = new URLSearchParams();
            params.append('taskId', taskId);
            params.append('taskName', taskName);
            params.append('status', status);
            params.append('assignee', assignee);
            params.append('deadline', deadline);
            params.append('duration', duration);
            params.append('progress', progress);
            params.append('supportCenter', supportCenter);
            
            // 跳转到服务评价页面
            window.location.href = `evaluation.html?${params.toString()}`;
        }

        // 执行任务
        function executeTask(subtaskId, subtaskName, assignee) {
            // 打开任务执行页面
            openTodoExecution(subtaskId, subtaskName, '进行中', assignee, '2026/01/20', '5天', '0%', '设计中心');
        }

        // 检查是否显示执行按钮
        function showExecuteButton(assignee) {
            // 当前登录用户（模拟）
            const currentUser = '张经理';
            // 只有当子任务负责人是当前登录用户时显示执行按钮
            return assignee === currentUser;
        }
    </script>
</head>
<body class="text-slate-600 h-screen flex overflow-hidden font-sans">

    <main class="flex-1 flex flex-col min-w-0 overflow-hidden relative bg-[#F4F7FE]">
        
       

        <div class="flex-1 overflow-y-auto p-6 relative scroll-smooth" id="scrollContainer">
            
            <div id="tasks" class="page-section active max-w-[1600px] mx-auto space-y-6 pb-20">
                
            
                
                <!-- 态势卡片和提报任务按钮 -->
                <div class="flex flex-col lg:flex-row gap-4">
                    <!-- 左侧态势卡片 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 flex-1 gap-4">
                        <!-- 我的任务卡片 -->
                        <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 hover:shadow-md transition-all duration-300 cursor-pointer" id="myTasksCard">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="user" class="w-5 h-5 text-indigo-500"></i>
                                <h3 class="font-bold text-slate-800">我的任务</h3>
                            </div>
                            <p class="text-3xl font-bold text-slate-800" id="myTasksCount">0</p>
                            <p class="text-xs text-slate-400 mt-1">本人处理的任务</p>
                        </div>
                        <!-- 待确认卡片 -->
                        <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 hover:shadow-md transition-all duration-300 cursor-pointer" data-filter="待确认">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="clipboard-list" class="w-5 h-5 text-blue-500"></i>
                                <h3 class="font-bold text-slate-800">待确认</h3>
                            </div>
                            <p class="text-3xl font-bold text-slate-800">12</p>
                            <p class="text-xs text-slate-400 mt-1">等待确认的任务</p>
                        </div>
                        <!-- 进行中卡片 -->
                        <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 hover:shadow-md transition-all duration-300 cursor-pointer" data-filter="进行中">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="activity" class="w-5 h-5 text-indigo-500"></i>
                                <h3 class="font-bold text-slate-800">进行中</h3>
                            </div>
                            <p class="text-3xl font-bold text-slate-800">45</p>
                            <p class="text-xs text-slate-400 mt-1">正在执行的任务</p>
                        </div>
                        <!-- 待评价卡片 -->
                        <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 hover:shadow-md transition-all duration-300 cursor-pointer" data-filter="待评价">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="star" class="w-5 h-5 text-yellow-500"></i>
                                <h3 class="font-bold text-slate-800">待评价</h3>
                            </div>
                            <p class="text-3xl font-bold text-slate-800">20</p>
                            <p class="text-xs text-slate-400 mt-1">等待评价的任务</p>
                        </div>
                        <!-- 已超期卡片 -->
                        <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 hover:shadow-md transition-all duration-300 cursor-pointer" data-filter="已超期">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="alert-circle" class="w-5 h-5 text-red-500"></i>
                                <h3 class="font-bold text-slate-800">已超期</h3>
                            </div>
                            <p class="text-3xl font-bold text-slate-800">3</p>
                            <p class="text-xs text-slate-400 mt-1">已超过期限的任务</p>
                        </div>
                    </div>
                    
                    <!-- 右侧提报任务按钮 -->
                    <div class="flex-shrink-0 w-full lg:w-24">
                        <button onclick="openTaskReport()" class="w-full h-full flex items-center justify-center gap-2 bg-indigo-600 text-white text-sm rounded-xl hover:bg-indigo-700 active:bg-indigo-800 disabled:bg-indigo-300 shadow-sm shadow-indigo-200 transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] font-medium">
                            <i data-lucide="plus" class="w-4 h-4"></i> 提报任务
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                    <div class="space-y-4">
                        <!-- 任务项1 -->
                        <div class="border border-slate-100 rounded-xl bg-white shadow-sm hover:shadow-md transition-shadow overflow-hidden">
                            <!-- 主任务 -->
                            <div class="p-4 relative">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <div class="flex items-center gap-2 mb-2">
                                            <h4 class="font-bold text-slate-800">机场T3航站楼图纸深化任务</h4>
                                            <span class="px-2 py-1 bg-orange-50 text-orange-600 text-xs rounded">待接单</span>
                                        </div>
                                        <div class="text-xs text-slate-400 mb-3">任务ID: 202601130001</div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="switchPage('task-detail', event)" class="px-3 py-1.5 bg-indigo-600 text-white text-xs rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-sm shadow-indigo-100">
                                            查看详情
                                        </button>
                                        <!-- 需求确认按钮 - 仅在任务状态为"待审批"时显示 -->
                                        <button class="px-3 py-1.5 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors font-medium hidden">
                                            需求确认
                                        </button>
                                        <!-- 任务分解按钮 - 仅在状态为"进行中"时显示 -->
                                        <button class="px-3 py-1.5 bg-green-100 text-green-600 text-xs rounded-lg hover:bg-green-200 transition-colors font-medium" onclick="openTaskDecomposition('202601130001', '机场T3航站楼图纸深化任务', '进行中', '李设计', '2026/01/20', '7天', '0%', '设计中心', event)">
                                            任务分解
                                        </button>
                                        <!-- 服务评价按钮 - 仅在状态为"已完成"时显示 -->
                                        <button class="px-3 py-1.5 bg-yellow-100 text-yellow-600 text-xs rounded-lg hover:bg-yellow-200 transition-colors font-medium" onclick="openTaskEvaluation('202601130001', '机场T3航站楼图纸深化任务', '已完成', '李设计', '2026/01/20', '7天', '0%', '设计中心', event)">
                                            服务评价
                                        </button>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-slate-500 mb-3">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心</span>
                                        <span class="font-medium text-slate-800">设计中心</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持人员</span>
                                        <span class="font-medium text-slate-800">李设计</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">截止时间</span>
                                        <span class="font-medium text-slate-800">2026/01/20</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务时限</span>
                                        <span class="font-medium text-slate-800">7天</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报项目</span>
                                        <span class="font-medium text-slate-800">机场T3航站楼项目</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报人员</span>
                                        <span class="font-medium text-slate-800">张经理</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">完成进度</span>
                                        <span class="font-medium text-slate-800">0%</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">评价状态</span>
                                        <span class="font-medium text-slate-800">待评价</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">发布时间: 2026/01/13</span>
                                    <div class="flex items-center gap-2">
                                        <a href="#" onclick="toggleSubtasks('task1'); event.preventDefault();" class="text-sm text-indigo-600 hover:text-indigo-800 cursor-pointer">子任务数（2）</a>
                                        <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 transition-transform" id="task1Icon"></i>
                                    </div>
                                </div>
                            </div>
                            <!-- 子任务 -->
                            <div id="task1Subtasks" class="hidden border-t border-slate-100">
                                <div class="p-4 bg-slate-50 border-b border-slate-200 relative group">
                                    <div class="flex items-start mb-3">
                                        <div class="flex items-center gap-2">
                                            <h5 class="font-medium text-slate-700">图纸深化设计</h5>
                                            <span class="px-2 py-1 bg-orange-50 text-orange-600 text-xs rounded">待接单</span>
                                            <div class="text-xs text-slate-400">任务ID: 202601130002</div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-500 mt-3 mb-2">
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">支持人员</span>
                                            <span class="font-medium text-slate-800">张经理</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">截止时间</span>
                                            <span class="font-medium text-slate-800">2026/01/18</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">完成进度</span>
                                            <span class="font-medium text-slate-800">0%</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">任务时限</span>
                                            <span class="font-medium text-slate-800">5天</span>
                                        </div>
                                    </div>
                                    <!-- 悬停显示的操作按钮 -->
                                    <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                        <!-- 完成服务按钮 - 仅当子任务负责人是当前登录用户时显示 -->
                                        <button class="px-2 py-1 bg-indigo-100 text-indigo-600 text-xs rounded-lg hover:bg-indigo-200 transition-colors font-medium" onclick="executeTask('202601130002', '图纸深化设计', '张经理', 'complete')" style="display: none;">
                                            完成服务
                                        </button>
                                        <!-- 进度上报按钮 - 仅当子任务负责人是当前登录用户时显示 -->
                                        <button class="px-2 py-1 bg-indigo-100 text-indigo-600 text-xs rounded-lg hover:bg-indigo-200 transition-colors font-medium" onclick="executeTask('202601130002', '图纸深化设计', '张经理', 'report')" style="display: none;">
                                            进度上报
                                        </button>
                                        <button class="px-2 py-1 bg-yellow-100 text-yellow-600 text-xs rounded-lg hover:bg-yellow-200 transition-colors font-medium">
                                            催办
                                        </button>
                                        <button class="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors font-medium">
                                            转派
                                        </button>
                                    </div>
                                </div>
                                <div class="p-4 bg-slate-50 relative group">
                                    <div class="flex items-start mb-3">
                                        <div class="flex items-center gap-2">
                                            <h5 class="font-medium text-slate-700">图纸审核</h5>
                                            <span class="px-2 py-1 bg-orange-50 text-orange-600 text-xs rounded">待接单</span>
                                            <div class="text-xs text-slate-400">任务ID: 202601130003</div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-500 mt-3 mb-2">
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">支持人员</span>
                                            <span class="font-medium text-slate-800">李设计</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">截止时间</span>
                                            <span class="font-medium text-slate-800">2026/01/20</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">完成进度</span>
                                            <span class="font-medium text-slate-800">0%</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">任务时限</span>
                                            <span class="font-medium text-slate-800">2天</span>
                                        </div>
                                    </div>
                                    <!-- 悬停显示的操作按钮 -->
                                    <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                        <!-- 完成服务按钮 - 仅当子任务负责人是当前登录用户时显示 -->
                                        <button class="px-2 py-1 bg-indigo-100 text-indigo-600 text-xs rounded-lg hover:bg-indigo-200 transition-colors font-medium" onclick="executeTask('202601130003', '图纸审核', '李设计', 'complete')" style="display: none;">
                                            完成服务
                                        </button>
                                        <!-- 进度上报按钮 - 仅当子任务负责人是当前登录用户时显示 -->
                                        <button class="px-2 py-1 bg-indigo-100 text-indigo-600 text-xs rounded-lg hover:bg-indigo-200 transition-colors font-medium" onclick="executeTask('202601130003', '图纸审核', '李设计', 'report')" style="display: none;">
                                            进度上报
                                        </button>
                                        <button class="px-2 py-1 bg-yellow-100 text-yellow-600 text-xs rounded-lg hover:bg-yellow-200 transition-colors font-medium">
                                            催办
                                        </button>
                                        <button class="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors font-medium">
                                            转派
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 任务项2 -->
                        <div class="border border-slate-100 rounded-xl bg-white shadow-sm hover:shadow-md transition-shadow overflow-hidden">
                            <!-- 主任务 -->
                            <div class="p-4 relative">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <div class="flex items-center gap-2 mb-2">
                                            <h4 class="font-bold text-slate-800">二期工程钢材集采询价</h4>
                                            <span class="px-2 py-1 bg-indigo-50 text-indigo-600 text-xs rounded">进行中</span>
                                        </div>
                                        <div class="text-xs text-slate-400 mb-3">任务ID: 202601150001</div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="switchPage('task-detail', event)" class="px-3 py-1.5 bg-indigo-600 text-white text-xs rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-sm shadow-indigo-100">
                                            查看详情
                                        </button>
                                        <!-- 需求确认按钮 - 仅在任务状态为"待审批"时显示 -->
                                        <button class="px-3 py-1.5 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors font-medium hidden">
                                            需求确认
                                        </button>
                                        <!-- 任务分解按钮 - 仅在任务状态为"已确认未完成"时显示 -->
                                        <button class="px-3 py-1.5 bg-green-100 text-green-600 text-xs rounded-lg hover:bg-green-200 transition-colors font-medium">
                                            任务分解
                                        </button>
                                        <!-- 服务评价按钮 - 仅在任务状态为"已完成未评价"时显示 -->
                                        <button class="px-3 py-1.5 bg-yellow-100 text-yellow-600 text-xs rounded-lg hover:bg-yellow-200 transition-colors font-medium">
                                            服务评价
                                        </button>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-slate-500 mb-3">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心</span>
                                        <span class="font-medium text-slate-800">供应链中心</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持人员</span>
                                        <span class="font-medium text-slate-800">王采购</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">截止时间</span>
                                        <span class="font-medium text-slate-800">2026/01/25</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务时限</span>
                                        <span class="font-medium text-slate-800">5天</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报项目</span>
                                        <span class="font-medium text-slate-800">二期工程项目</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报人员</span>
                                        <span class="font-medium text-slate-800">张经理</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">完成进度</span>
                                        <span class="font-medium text-slate-800">60%</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">评价状态</span>
                                        <span class="font-medium text-slate-800">待评价</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">发布时间: 2026/01/15</span>
                                    <div class="flex items-center gap-2">
                                        <a href="#" onclick="toggleSubtasks('task2'); event.preventDefault();" class="text-sm text-indigo-600 hover:text-indigo-800 cursor-pointer">子任务数（1）</a>
                                        <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 transition-transform" id="task2Icon"></i>
                                    </div>
                                </div>
                            </div>
                            <!-- 子任务 -->
                            <div id="task2Subtasks" class="hidden border-t border-slate-100">
                                <div class="p-4 bg-slate-50 border-b border-slate-200 relative group">
                                    <div class="flex justify-between items-start mb-3">
                                        <div>
                                            <h5 class="font-medium text-slate-700">钢材供应商询价</h5>
                                            <div class="text-xs text-slate-400 mt-1">任务ID: 202601150002</div>
                                        </div>
                                        <span class="px-2 py-1 bg-indigo-50 text-indigo-600 text-xs rounded">进行中</span>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-500 mt-3 mb-2">
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">支持人员</span>
                                            <span class="font-medium text-slate-800">王采购</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">截止时间</span>
                                            <span class="font-medium text-slate-800">2026/01/22</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">完成进度</span>
                                            <span class="font-medium text-slate-800">80%</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">任务时限</span>
                                            <span class="font-medium text-slate-800">3天</span>
                                        </div>
                                    </div>
                                    <!-- 悬停显示的操作按钮 -->
                                    <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                        <!-- 完成服务按钮 - 仅当子任务负责人是当前登录用户时显示 -->
                                        <button class="px-2 py-1 bg-indigo-100 text-indigo-600 text-xs rounded-lg hover:bg-indigo-200 transition-colors font-medium" onclick="executeTask('202601150002', '钢材供应商询价', '王采购', 'complete')" style="display: none;">
                                            完成服务
                                        </button>
                                        <!-- 进度上报按钮 - 仅当子任务负责人是当前登录用户时显示 -->
                                        <button class="px-2 py-1 bg-indigo-100 text-indigo-600 text-xs rounded-lg hover:bg-indigo-200 transition-colors font-medium" onclick="executeTask('202601150002', '钢材供应商询价', '王采购', 'report')" style="display: none;">
                                            进度上报
                                        </button>
                                        <button class="px-2 py-1 bg-yellow-100 text-yellow-600 text-xs rounded-lg hover:bg-yellow-200 transition-colors font-medium">
                                            催办
                                        </button>
                                        <button class="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors font-medium">
                                            转派
                                        </button>
                                    </div>
                                </div>
                                <div class="p-4 bg-slate-50 relative group">
                                    <div class="flex justify-between items-start mb-3">
                                        <div>
                                            <h5 class="font-medium text-slate-700">价格分析与对比</h5>
                                            <div class="text-xs text-slate-400 mt-1">任务ID: 202601150003</div>
                                        </div>
                                        <span class="px-2 py-1 bg-orange-50 text-orange-600 text-xs rounded">待接单</span>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-500 mt-3 mb-2">
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">支持人员</span>
                                            <span class="font-medium text-slate-800">王采购</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">截止时间</span>
                                            <span class="font-medium text-slate-800">2026/01/25</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">完成进度</span>
                                            <span class="font-medium text-slate-800">0%</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">任务时限</span>
                                            <span class="font-medium text-slate-800">2天</span>
                                        </div>
                                    </div>
                                    <!-- 悬停显示的操作按钮 -->
                                    <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                        <button class="px-2 py-1 bg-indigo-100 text-indigo-600 text-xs rounded-lg hover:bg-indigo-200 transition-colors font-medium">
                                            执行
                                        </button>
                                        <button class="px-2 py-1 bg-yellow-100 text-yellow-600 text-xs rounded-lg hover:bg-yellow-200 transition-colors font-medium">
                                            催办
                                        </button>
                                        <button class="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors font-medium">
                                            转派
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    <!-- 任务项3 - 待审批状态 -->
                        <div class="border border-slate-100 rounded-xl bg-white shadow-sm hover:shadow-md transition-shadow overflow-hidden">
                            <!-- 主任务 -->
                            <div class="p-4 relative">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <div class="flex items-center gap-2 mb-2">
                                            <h4 class="font-bold text-slate-800">技术方案审核任务</h4>
                                            <span class="px-2 py-1 bg-blue-50 text-blue-600 text-xs rounded">待审批</span>
                                        </div>
                                        <div class="text-xs text-slate-400 mb-3">任务ID: 202601140001</div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="switchPage('task-detail', event)" class="px-3 py-1.5 bg-indigo-600 text-white text-xs rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-sm shadow-indigo-100">
                                            查看详情
                                        </button>
                                        <!-- 需求确认按钮 - 仅在任务状态为"待审批"时显示 -->
                                        <button onclick="openTaskApproval('202601140001', '技术方案审核任务', '待审批', '王总工', '2026/01/24', '3天', '0%', '技术中心', event)" class="px-3 py-1.5 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors font-medium">
                                            需求确认
                                        </button>
                                        <!-- 任务分解按钮 - 仅在状态为"进行中"时显示 -->
                                        <button class="px-3 py-1.5 bg-green-100 text-green-600 text-xs rounded-lg hover:bg-green-200 transition-colors font-medium hidden">
                                            任务分解
                                        </button>
                                        <!-- 服务评价按钮 - 仅在状态为"已完成"时显示 -->
                                        <button class="px-3 py-1.5 bg-yellow-100 text-yellow-600 text-xs rounded-lg hover:bg-yellow-200 transition-colors font-medium hidden">
                                            服务评价
                                        </button>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-slate-500 mb-3">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心</span>
                                        <span class="font-medium text-slate-800">技术中心</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持人员</span>
                                        <span class="font-medium text-slate-800">王总工</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">截止时间</span>
                                        <span class="font-medium text-slate-800">2026/01/24</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务时限</span>
                                        <span class="font-medium text-slate-800">3天</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报项目</span>
                                        <span class="font-medium text-slate-800">机场T3航站楼项目</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报人员</span>
                                        <span class="font-medium text-slate-800">张经理</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">完成进度</span>
                                        <span class="font-medium text-slate-800">0%</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">评价状态</span>
                                        <span class="font-medium text-slate-800">待评价</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">发布时间: 2026/01/14</span>
                                    <div class="flex items-center gap-2">
                                        <a href="#" onclick="toggleSubtasks('task3'); event.preventDefault();" class="text-sm text-indigo-600 hover:text-indigo-800 cursor-pointer">子任务数（1）</a>
                                        <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 transition-transform" id="task3Icon"></i>
                                    </div>
                                </div>
                            </div>
                            <!-- 子任务 -->
                            <div id="task3Subtasks" class="hidden border-t border-slate-100">
                                <div class="p-4 bg-slate-50 border-b border-slate-200 relative group">
                                    <div class="flex items-start mb-3">
                                        <div class="flex items-center gap-2">
                                            <h5 class="font-medium text-slate-700">技术方案审核</h5>
                                            <span class="px-2 py-1 bg-blue-50 text-blue-600 text-xs rounded">待审批</span>
                                            <div class="text-xs text-slate-400">任务ID: 202601140002</div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-500 mt-3 mb-2">
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">支持人员</span>
                                            <span class="font-medium text-slate-800">王总工</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">截止时间</span>
                                            <span class="font-medium text-slate-800">2026/01/24</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">完成进度</span>
                                            <span class="font-medium text-slate-800">0%</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">任务时限</span>
                                            <span class="font-medium text-slate-800">3天</span>
                                        </div>
                                    </div>
                                    <!-- 悬停显示的操作按钮 -->
                                    <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                        <button class="px-2 py-1 bg-indigo-100 text-indigo-600 text-xs rounded-lg hover:bg-indigo-200 transition-colors font-medium">
                                            执行
                                        </button>
                                        <button class="px-2 py-1 bg-yellow-100 text-yellow-600 text-xs rounded-lg hover:bg-yellow-200 transition-colors font-medium">
                                            催办
                                        </button>
                                        <button class="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors font-medium">
                                            转派
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 任务项4 - 已完成状态 -->
                        <div class="border border-slate-100 rounded-xl bg-white shadow-sm hover:shadow-md transition-shadow overflow-hidden">
                            <!-- 主任务 -->
                            <div class="p-4 relative">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <div class="flex items-center gap-2 mb-2">
                                            <h4 class="font-bold text-slate-800">商务合同评审任务</h4>
                                            <span class="px-2 py-1 bg-green-50 text-green-600 text-xs rounded">已完成</span>
                                        </div>
                                        <div class="text-xs text-slate-400 mb-3">任务ID: 202601120001</div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="switchPage('task-detail', event)" class="px-3 py-1.5 bg-indigo-600 text-white text-xs rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-sm shadow-indigo-100">
                                            查看详情
                                        </button>
                                        <!-- 需求确认按钮 - 仅在任务状态为"待审批"时显示 -->
                                        <button class="px-3 py-1.5 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors font-medium hidden">
                                            需求确认
                                        </button>
                                        <!-- 任务分解按钮 - 仅在状态为"进行中"时显示 -->
                                        <button class="px-3 py-1.5 bg-green-100 text-green-600 text-xs rounded-lg hover:bg-green-200 transition-colors font-medium hidden">
                                            任务分解
                                        </button>
                                        <!-- 服务评价按钮 - 仅在状态为"已完成"时显示 -->
                                        <button onclick="openTaskEvaluation('202601120001', '商务合同评审任务', '已完成', '赵商务', '2026/01/15', '3天', '100%', '商务中心', event)" class="px-3 py-1.5 bg-yellow-100 text-yellow-600 text-xs rounded-lg hover:bg-yellow-200 transition-colors font-medium">
                                            服务评价
                                        </button>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-slate-500 mb-3">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心</span>
                                        <span class="font-medium text-slate-800">商务中心</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持人员</span>
                                        <span class="font-medium text-slate-800">赵商务</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">截止时间</span>
                                        <span class="font-medium text-slate-800">2026/01/15</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务时限</span>
                                        <span class="font-medium text-slate-800">3天</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报项目</span>
                                        <span class="font-medium text-slate-800">机场T3航站楼项目</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报人员</span>
                                        <span class="font-medium text-slate-800">张经理</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">完成进度</span>
                                        <span class="font-medium text-slate-800">100%</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">评价状态</span>
                                        <span class="font-medium text-slate-800">待评价</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">发布时间: 2026/01/12</span>
                                    <div class="flex items-center gap-2">
                                        <a href="#" onclick="toggleSubtasks('task4'); event.preventDefault();" class="text-sm text-indigo-600 hover:text-indigo-800 cursor-pointer">子任务数（1）</a>
                                        <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 transition-transform" id="task4Icon"></i>
                                    </div>
                                </div>
                            </div>
                            <!-- 子任务 -->
                            <div id="task4Subtasks" class="hidden border-t border-slate-100">
                                <div class="p-4 bg-slate-50 relative group">
                                    <div class="flex justify-between items-start mb-3">
                                        <div>
                                            <h5 class="font-medium text-slate-700">合同条款评审</h5>
                                            <div class="text-xs text-slate-400 mt-1">任务ID: 202601120002</div>
                                        </div>
                                        <span class="px-2 py-1 bg-green-50 text-green-600 text-xs rounded">已完成</span>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-500 mt-3 mb-2">
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">支持人员</span>
                                            <span class="font-medium text-slate-800">赵商务</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">截止时间</span>
                                            <span class="font-medium text-slate-800">2026/01/15</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">完成进度</span>
                                            <span class="font-medium text-slate-800">100%</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <span class="text-slate-600">任务时限</span>
                                            <span class="font-medium text-slate-800">3天</span>
                                        </div>
                                    </div>
                                    <!-- 悬停显示的操作按钮 -->
                                    <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                        <button class="px-2 py-1 bg-yellow-100 text-yellow-600 text-xs rounded-lg hover:bg-yellow-200 transition-colors font-medium">
                                            催办
                                        </button>
                                        <button class="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors font-medium">
                                            转派
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>

            </div>

            <!-- 任务提报页面 -->
            <div id="task-report" class="page-section max-w-[1600px] mx-auto space-y-6 pb-20">
                <div class="flex flex-wrap gap-4 items-center justify-between">
                    <h2 class="text-2xl font-bold text-slate-800">任务提报</h2>
                    <div class="flex gap-3">
                        <button onclick="switchPage('tasks', event)" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 text-sm rounded-lg hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回任务大厅
                        </button>
                        <button type="button" onclick="saveTaskDraft()" class="px-4 py-2 bg-white border border-slate-200 text-slate-700 text-sm rounded-lg hover:bg-slate-50 transition-colors font-medium shadow-sm">
                            保存
                        </button>
                        <button type="button" onclick="submitTaskReport()" class="px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-sm shadow-indigo-100">
                            提审
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 relative">
                    <form>
                        <!-- 基础信息部分 -->
                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-slate-800 mb-4">基础信息</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">任务ID</label>
                                    <input type="text" value="自动生成" disabled class="w-full px-4 py-2 border border-slate-200 rounded-lg bg-slate-50 text-slate-400">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">申报项目</label>
                                    <input type="text" value="机场T3航站楼项目" disabled class="w-full px-4 py-2 border border-slate-200 rounded-lg bg-slate-50 text-slate-400">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">提报人员</label>
                                    <input type="text" value="张经理" disabled class="w-full px-4 py-2 border border-slate-200 rounded-lg bg-slate-50 text-slate-400">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">创建时间</label>
                                    <input type="text" value="2026/01/20 10:00" disabled class="w-full px-4 py-2 border border-slate-200 rounded-lg bg-slate-50 text-slate-400">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">最近修改时间</label>
                                    <input type="text" value="2026/01/20 10:00" disabled class="w-full px-4 py-2 border border-slate-200 rounded-lg bg-slate-50 text-slate-400">
                                </div>
                            </div>
                        </div>

                        <!-- 工作项部分 -->
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-bold text-slate-800">工作项</h3>
                                <div class="flex gap-3">
                                    <button type="button" onclick="openWorkItemModal()" class="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-sm shadow-indigo-100">
                                        <i data-lucide="plus" class="w-4 h-4"></i> 提报工作项
                                    </button>
                                </div>
                            </div>
                            <div id="workItemCards" class="space-y-4">
                                <!-- 工作项需求卡片将在这里动态生成 -->
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 工作项选择弹窗 -->
            <div id="workItemModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
                <div class="bg-white rounded-2xl shadow-xl w-full max-w-4xl max-h-[80vh] overflow-y-auto">
                    <div class="p-6 border-b border-slate-100">
                        <div class="flex justify-between items-center">
                            <h3 class="text-xl font-bold text-slate-800">选择工作项</h3>
                            <button type="button" onclick="closeWorkItemModal()" class="text-slate-400 hover:text-slate-600">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                        <div class="mt-4">
                            <div class="relative">
                                <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                                <input type="text" id="workItemSearch" placeholder="按职能名称搜索..." class="pl-10 pr-4 py-2 bg-slate-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-indigo-100 w-full border-transparent transition-all">
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="border-b border-slate-200">
                                    <th class="text-left py-3 px-4 text-sm font-medium text-slate-700 w-12">选择</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-slate-700">支持中心名称</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-slate-700">一级职能</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-slate-700">二级职能</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-slate-700">支持机制</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-slate-700">输出成果</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-slate-700">完成时限</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-slate-100 hover:bg-slate-50">
                                    <td class="py-3 px-4"><input type="checkbox" class="workItemCheckbox" value="1"></td>
                                    <td class="py-3 px-4 text-sm text-slate-600">设计中心</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">图纸设计</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">建筑设计</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">专家评审</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">施工图</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">7天</td>
                                </tr>
                                <tr class="border-b border-slate-100 hover:bg-slate-50">
                                    <td class="py-3 px-4"><input type="checkbox" class="workItemCheckbox" value="2"></td>
                                    <td class="py-3 px-4 text-sm text-slate-600">技术中心</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">技术支持</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">结构计算</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">现场指导</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">计算书</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">5天</td>
                                </tr>
                                <tr class="border-b border-slate-100 hover:bg-slate-50">
                                    <td class="py-3 px-4"><input type="checkbox" class="workItemCheckbox" value="3"></td>
                                    <td class="py-3 px-4 text-sm text-slate-600">商务中心</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">商务谈判</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">合同评审</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">法务支持</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">合同文本</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">3天</td>
                                </tr>
                                <tr class="border-b border-slate-100 hover:bg-slate-50">
                                    <td class="py-3 px-4"><input type="checkbox" class="workItemCheckbox" value="4"></td>
                                    <td class="py-3 px-4 text-sm text-slate-600">供应链中心</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">材料采购</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">设备询价</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">集中采购</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">报价单</td>
                                    <td class="py-3 px-4 text-sm text-slate-600">2天</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="p-6 border-t border-slate-100 flex justify-end gap-4">
                        <button type="button" onclick="closeWorkItemModal()" class="px-6 py-2.5 bg-white border border-slate-200 text-slate-700 text-sm rounded-lg hover:bg-slate-50 transition-colors font-medium shadow-sm">
                            取消
                        </button>
                        <button type="button" onclick="confirmWorkItemSelection()" class="px-6 py-2.5 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-sm shadow-indigo-100">
                            确认选择
                        </button>
                    </div>
                </div>
            </div>

            <!-- 任务详情页面 -->
            <div id="task-detail" class="page-section max-w-[1600px] mx-auto space-y-6 pb-20">
                <div class="flex flex-wrap gap-4 items-center justify-between">
                    <h2 class="text-2xl font-bold text-slate-800">任务详情</h2>
                    <div class="flex gap-3">
                        <button onclick="withdrawTask()" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 text-sm rounded-lg hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                            <i data-lucide="rotate-ccw" class="w-4 h-4"></i> 撤回
                        </button>
                        <button onclick="abandonTask()" class="px-4 py-2 bg-white border border-red-200 text-red-600 text-sm rounded-lg hover:bg-red-50 flex items-center gap-2 shadow-sm">
                            <i data-lucide="trash-2" class="w-4 h-4"></i> 废弃
                        </button>
                        <button onclick="switchPage('tasks', event)" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 text-sm rounded-lg hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                    <div class="mb-6">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded font-bold">待确认</span>
                            <h3 class="text-lg font-bold text-slate-800">机场T3航站楼图纸深化任务</h3>
                        </div>
                        <div class="text-sm text-slate-400 mb-6">任务ID: 202601130001</div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">提报信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报人员</span>
                                        <span class="font-medium text-slate-800">张经理</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报项目</span>
                                        <span class="font-medium text-slate-800">机场T3航站楼项目</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报时间</span>
                                        <span class="font-medium text-slate-800">2026/01/13</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">任务信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务状态</span>
                                        <span class="font-medium text-orange-600">待确认</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务时限</span>
                                        <span class="font-medium text-slate-800">7天</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">评估产值</span>
                                        <span class="font-medium text-slate-800">¥ 50,000</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">支持信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心</span>
                                        <span class="font-medium text-slate-800">设计中心</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持人员</span>
                                        <span class="font-medium text-slate-800">李设计</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">联系方式</span>
                                        <span class="font-medium text-slate-800">138****5678</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-amber-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">时间信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">创建时间</span>
                                        <span class="font-medium text-slate-800">2026/01/13 10:00</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">最近修改</span>
                                        <span class="font-medium text-slate-800">2026/01/13 10:00</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">计划完成</span>
                                        <span class="font-medium text-slate-800">2026/01/20</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-slate-700 mb-3">任务描述</h4>
                            <div class="p-4 bg-slate-50 border border-slate-100 rounded-lg text-sm text-slate-700 leading-relaxed">
                                完成机场T3航站楼图纸深化任务，包括结构、机电、装修等专业图纸的审核和深化设计。需要确保图纸符合规范要求，满足施工需要，并在7天内完成所有工作。
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-bold text-slate-800 mb-4">待办任务列表</h3>
                        <div class="space-y-4">
                            <div class="p-4 border border-slate-100 rounded-xl bg-white shadow-sm hover:shadow-md transition-shadow cursor-pointer" onclick="openTodoDetail('202601130002', '图纸深化设计', '进行中', '李设计', '2026/01/20', '5天', '0%', '设计中心')">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h4 class="font-bold text-slate-800">图纸深化设计</h4>
                                        <p class="text-xs text-slate-400 mt-1">任务ID: 202601130002</p>
                                    </div>
                                    <span class="px-2 py-1 bg-indigo-50 text-indigo-600 text-xs rounded">进行中</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-500 mb-3">
                                    <div class="flex items-center gap-1">
                                        <i data-lucide="user" class="w-3 h-3"></i>
                                        <span>李设计</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <i data-lucide="calendar" class="w-3 h-3"></i>
                                        <span>2026/01/20</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <i data-lucide="clock" class="w-3 h-3"></i>
                                        <span>5天</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <i data-lucide="trending-up" class="w-3 h-3"></i>
                                        <span>0%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 border border-slate-100 rounded-xl bg-white shadow-sm hover:shadow-md transition-shadow cursor-pointer" onclick="openTodoDetail('202601130003', '图纸审核', '待接单', '王总工', '2026/01/20', '2天', '0%', '设计中心')">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h4 class="font-bold text-slate-800">图纸审核</h4>
                                        <p class="text-xs text-slate-400 mt-1">任务ID: 202601130003</p>
                                    </div>
                                    <span class="px-2 py-1 bg-orange-50 text-orange-600 text-xs rounded">待接单</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-500 mb-3">
                                    <div class="flex items-center gap-1">
                                        <i data-lucide="user" class="w-3 h-3"></i>
                                        <span>王总工</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <i data-lucide="calendar" class="w-3 h-3"></i>
                                        <span>2026/01/20</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <i data-lucide="clock" class="w-3 h-3"></i>
                                        <span>2天</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <i data-lucide="trending-up" class="w-3 h-3"></i>
                                        <span>0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-bold text-slate-800 mb-4">审批记录</h3>
                        <div class="space-y-6">
                            <div class="relative pl-8">
                                <div class="absolute left-0 top-1 w-4 h-4 rounded-full bg-indigo-600 border-4 border-white shadow-sm"></div>
                                <div class="bg-white p-4 rounded-lg border border-slate-100 shadow-sm">
                                    <div class="flex justify-between items-center mb-2">
                                        <h4 class="font-bold text-slate-800">提报申请</h4>
                                        <span class="text-sm text-slate-400">2026/01/13 10:00</span>
                                    </div>
                                    <p class="text-sm text-slate-600 mb-3">张经理提报了机场T3航站楼图纸深化任务</p>
                                    <div class="flex items-center gap-3">
                                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-8 h-8 rounded-full">
                                        <div>
                                            <div class="text-sm font-medium text-slate-800">张经理</div>
                                            <div class="text-xs text-slate-400">提报人</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="relative pl-8">
                                <div class="absolute left-0 top-1 w-4 h-4 rounded-full bg-slate-300 border-4 border-white shadow-sm"></div>
                                <div class="bg-white p-4 rounded-lg border border-slate-100 shadow-sm opacity-70">
                                    <div class="flex justify-between items-center mb-2">
                                        <h4 class="font-bold text-slate-800">项目经理审批</h4>
                                        <span class="text-sm text-slate-400">待审批</span>
                                    </div>
                                    <p class="text-sm text-slate-600 mb-3">等待项目经理审批</p>
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center">
                                            <i data-lucide="user" class="w-4 h-4 text-slate-400"></i>
                                        </div>
                                        <div>
                                            <div class="text-sm font-medium text-slate-800">项目经理</div>
                                            <div class="text-xs text-slate-400">审批人</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="relative pl-8">
                                <div class="absolute left-0 top-1 w-4 h-4 rounded-full bg-slate-300 border-4 border-white shadow-sm"></div>
                                <div class="bg-white p-4 rounded-lg border border-slate-100 shadow-sm opacity-70">
                                    <div class="flex justify-between items-center mb-2">
                                        <h4 class="font-bold text-slate-800">总包中心审批</h4>
                                        <span class="text-sm text-slate-400">待审批</span>
                                    </div>
                                    <p class="text-sm text-slate-600 mb-3">等待总包中心审批</p>
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center">
                                            <i data-lucide="building" class="w-4 h-4 text-slate-400"></i>
                                        </div>
                                        <div>
                                            <div class="text-sm font-medium text-slate-800">总包中心</div>
                                            <div class="text-xs text-slate-400">审批人</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 待办详情页面 -->
            <div id="todo-detail" class="page-section max-w-[1600px] mx-auto space-y-6 pb-20">
                <div class="flex flex-wrap gap-4 items-center justify-between">
                    <h2 class="text-2xl font-bold text-slate-800">待办详情</h2>
                    <div class="flex gap-3">
                        <button onclick="switchPage('todo-detail', event)" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 text-sm rounded-lg hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回上一级页面
                        </button>
                        <button onclick="withdrawTask()" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 text-sm rounded-lg hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                            <i data-lucide="rotate-ccw" class="w-4 h-4"></i> 撤回
                        </button>
                        <button onclick="abandonTask()" class="px-4 py-2 bg-white border border-red-200 text-red-600 text-sm rounded-lg hover:bg-red-50 flex items-center gap-2 shadow-sm">
                            <i data-lucide="trash-2" class="w-4 h-4"></i> 废弃
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                    <div class="mb-6">
                        <div class="flex items-center gap-3 mb-4">
                            <span id="todoStatusBadge" class="px-2 py-1 bg-indigo-50 text-indigo-600 text-xs rounded">进行中</span>
                            <h3 id="todoTaskName" class="text-lg font-bold text-slate-800">图纸深化设计</h3>
                        </div>
                        <div id="todoTaskId" class="text-sm text-slate-400 mb-6">任务ID: 202601130002</div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">任务信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务状态</span>
                                        <span id="todoTaskStatus" class="font-medium text-indigo-600">进行中</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务时限</span>
                                        <span id="todoDuration" class="font-medium text-slate-800">5天</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">截止时间</span>
                                        <span id="todoDeadline" class="font-medium text-slate-800">2026/01/20</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">支持信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心</span>
                                        <span id="todoSupportCenter" class="font-medium text-slate-800">设计中心</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心人员</span>
                                        <span id="todoAssignee" class="font-medium text-slate-800">李设计</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">联系方式</span>
                                        <span class="font-medium text-slate-800">138****5678</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">进度信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">完成进度</span>
                                        <span id="todoProgress" class="font-medium text-slate-800">0%</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">实际完成时间</span>
                                        <span class="font-medium text-slate-800">未完成</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">创建时间</span>
                                        <span class="font-medium text-slate-800">2026/01/13 10:00</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-amber-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">其他信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">评估产值</span>
                                        <span class="font-medium text-slate-800">¥ 25,000</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报人员</span>
                                        <span class="font-medium text-slate-800">张经理</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报项目</span>
                                        <span class="font-medium text-slate-800">机场T3航站楼项目</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-slate-700 mb-3">内容描述</h4>
                            <div class="p-4 bg-slate-50 border border-slate-100 rounded-lg text-sm text-slate-700 leading-relaxed">
                                完成机场T3航站楼图纸深化设计任务，包括结构、机电、装修等专业图纸的审核和深化。需要确保图纸符合规范要求，满足施工需要，并在5天内完成所有工作。
                            </div>
                        </div>

                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-slate-700 mb-3">任务交付物</h4>
                            <div class="p-4 bg-slate-50 border border-slate-100 rounded-lg">
                                <div class="mb-4">
                                    <h5 class="text-xs font-medium text-slate-600 mb-2">交付物附件</h5>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between p-2 bg-white border border-slate-100 rounded-lg">
                                            <div class="flex items-center gap-2">
                                                <i data-lucide="file-pdf" class="w-4 h-4 text-red-500"></i>
                                                <span class="text-sm text-slate-700">图纸深化设计方案.pdf</span>
                                            </div>
                                            <button class="text-indigo-600 hover:text-indigo-800 text-sm">下载</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 bg-white border border-slate-100 rounded-lg">
                                            <div class="flex items-center gap-2">
                                                <i data-lucide="file-image" class="w-4 h-4 text-blue-500"></i>
                                                <span class="text-sm text-slate-700">图纸深化设计图纸.dwg</span>
                                            </div>
                                            <button class="text-indigo-600 hover:text-indigo-800 text-sm">下载</button>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="text-xs font-medium text-slate-600 mb-2">交付物说明</h5>
                                    <div class="p-3 bg-white border border-slate-100 rounded-lg text-sm text-slate-600">
                                        包含完整的图纸深化设计方案和相关图纸文件，确保所有专业图纸符合规范要求，满足施工需要。
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-sm font-bold text-slate-700 mb-3">工单操作记录</h4>
                            <div class="space-y-4">
                                <div class="flex items-start gap-3">
                                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="check-circle" class="w-4 h-4 text-indigo-600"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center mb-1">
                                            <h5 class="text-sm font-medium text-slate-800">任务创建</h5>
                                            <span class="text-xs text-slate-400">2026/01/13 10:00</span>
                                        </div>
                                        <p class="text-xs text-slate-600">张经理创建了图纸深化设计任务</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="user-plus" class="w-4 h-4 text-indigo-600"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center mb-1">
                                            <h5 class="text-sm font-medium text-slate-800">任务分配</h5>
                                            <span class="text-xs text-slate-400">2026/01/13 10:30</span>
                                        </div>
                                        <p class="text-xs text-slate-600">任务分配给李设计</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="clock" class="w-4 h-4 text-slate-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center mb-1">
                                            <h5 class="text-sm font-medium text-slate-800">等待接单</h5>
                                            <span class="text-xs text-slate-400">2026/01/13 10:30</span>
                                        </div>
                                        <p class="text-xs text-slate-600">任务已分配，等待李设计接单</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 待办执行页面 -->
            <div id="todo-execution" class="page-section max-w-[1600px] mx-auto space-y-6 pb-20">
                <div class="flex flex-wrap gap-4 items-center justify-between">
                    <h2 class="text-2xl font-bold text-slate-800">待办执行</h2>
                    <div class="flex gap-3">
                        <button onclick="switchPage('tasks', event)" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 text-sm rounded-lg hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回
                        </button>
                        <button id="completeExecutionButton" onclick="completeTaskExecution()" class="px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 flex items-center gap-2 shadow-sm shadow-indigo-100">
                            <i data-lucide="check-circle" class="w-4 h-4"></i> 完成执行
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                    <div class="mb-6">
                        <div class="flex items-center gap-3 mb-4">
                            <span id="executionStatusBadge" class="px-2 py-1 bg-indigo-50 text-indigo-600 text-xs rounded">进行中</span>
                            <h3 id="executionTaskName" class="text-lg font-bold text-slate-800">图纸深化设计</h3>
                        </div>
                        <div id="executionTaskId" class="text-sm text-slate-400 mb-6">任务ID: 202601130002</div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">任务信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务状态</span>
                                        <span id="executionTaskStatus" class="font-medium text-indigo-600">进行中</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务时限</span>
                                        <span id="executionDuration" class="font-medium text-slate-800">5天</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">截止时间</span>
                                        <span id="executionDeadline" class="font-medium text-slate-800">2026/01/20</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">支持信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心</span>
                                        <span id="executionSupportCenter" class="font-medium text-slate-800">设计中心</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心人员</span>
                                        <span id="executionAssignee" class="font-medium text-slate-800">李设计</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">联系方式</span>
                                        <span class="font-medium text-slate-800">138****5678</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">进度信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">完成进度</span>
                                        <span id="executionProgress" class="font-medium text-slate-800">0%</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">实际完成时间</span>
                                        <span class="font-medium text-slate-800">未完成</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">创建时间</span>
                                        <span class="font-medium text-slate-800">2026/01/13 10:00</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-amber-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">其他信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">评估产值</span>
                                        <span class="font-medium text-slate-800">¥ 25,000</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报人员</span>
                                        <span class="font-medium text-slate-800">张经理</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报项目</span>
                                        <span class="font-medium text-slate-800">机场T3航站楼项目</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-slate-700 mb-3">内容描述</h4>
                            <div class="p-4 bg-slate-50 border border-slate-100 rounded-lg text-sm text-slate-700 leading-relaxed">
                                完成机场T3航站楼图纸深化设计任务，包括结构、机电、装修等专业图纸的审核和深化。需要确保图纸符合规范要求，满足施工需要，并在5天内完成所有工作。
                            </div>
                        </div>

                        <!-- 执行进度更新 -->
                        <div id="executionProgressSection" class="mb-6">
                            <h4 class="text-sm font-bold text-slate-700 mb-3">执行进度</h4>
                            <div class="p-4 bg-slate-50 border border-slate-100 rounded-lg">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-slate-600 mb-2">完成进度</label>
                                    <div class="flex items-center gap-4">
                                        <input type="range" min="0" max="100" value="0" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" id="progressRange" oninput="updateProgressDisplay()">
                                        <span id="progressValue" class="text-sm font-medium text-slate-800 w-12 text-center">0%</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-600 mb-2">进度说明</label>
                                    <textarea rows="3" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100" placeholder="请描述当前执行状态和遇到的问题..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- 交付物上传 -->
                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-slate-700 mb-3">交付物上传</h4>
                            <div class="p-4 bg-slate-50 border border-slate-100 rounded-lg">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-slate-600 mb-2">交付物附件</label>
                                    <div class="mb-3">
                                        <label class="block text-xs text-slate-500 mb-2">选择模板</label>
                                        <div class="flex gap-2 mb-3">
                                            <button class="px-3 py-1.5 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors flex items-center gap-1">
                                                <i data-lucide="file-pdf" class="w-3 h-3"></i> 图纸深化模板
                                            </button>
                                            <button class="px-3 py-1.5 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors flex items-center gap-1">
                                                <i data-lucide="file-word" class="w-3 h-3"></i> 技术方案模板
                                            </button>
                                            <button class="px-3 py-1.5 bg-blue-100 text-blue-600 text-xs rounded-lg hover:bg-blue-200 transition-colors flex items-center gap-1">
                                                <i data-lucide="file-excel" class="w-3 h-3"></i> 成本核算模板
                                            </button>
                                        </div>
                                    </div>
                                    <div class="border-2 border-dashed border-slate-200 rounded-lg p-6 text-center">
                                        <i data-lucide="upload-cloud" class="w-12 h-12 text-slate-400 mx-auto mb-2"></i>
                                        <p class="text-sm text-slate-600 mb-4">点击或拖拽文件到此处上传</p>
                                        <input type="file" multiple class="hidden" id="fileUpload">
                                        <button onclick="document.getElementById('fileUpload').click()" class="px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors">
                                            选择文件
                                        </button>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-600 mb-2">交付物说明</label>
                                        <textarea rows="4" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100" placeholder="请详细描述交付物内容..."></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-600 mb-2">完成时间</label>
                                        <input type="date" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 执行记录 -->
                        <div>
                            <h4 class="text-sm font-bold text-slate-700 mb-3">执行记录</h4>
                            <div class="space-y-4">
                                <div class="flex items-start gap-3">
                                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="check-circle" class="w-4 h-4 text-indigo-600"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center mb-1">
                                            <h5 class="text-sm font-medium text-slate-800">任务开始</h5>
                                            <span class="text-xs text-slate-400">2026/01/13 10:00</span>
                                        </div>
                                        <p class="text-xs text-slate-600">任务开始执行</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="clock" class="w-4 h-4 text-slate-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center mb-1">
                                            <h5 class="text-sm font-medium text-slate-800">执行中</h5>
                                            <span class="text-xs text-slate-400">2026/01/13 10:30</span>
                                        </div>
                                        <p class="text-xs text-slate-600">李设计已接单，任务正在执行中</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 任务审批页面 -->
            <div id="task-approval" class="page-section max-w-[1600px] mx-auto space-y-6 pb-20">
                <div class="flex flex-wrap gap-4 items-center justify-between">
                    <h2 class="text-2xl font-bold text-slate-800">任务审批</h2>
                    <div class="flex gap-3">
                        <button onclick="switchPage('tasks', event)" class="px-4 py-2 bg-white border border-slate-200 text-slate-600 text-sm rounded-lg hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回任务大厅
                        </button>
                        <button onclick="submitApproval()" class="px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 flex items-center gap-2 shadow-sm shadow-indigo-100">
                            <i data-lucide="check-circle" class="w-4 h-4"></i> 提交审批
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                    <div class="mb-6">
                        <div class="flex items-center gap-3 mb-4">
                            <span id="approvalStatusBadge" class="px-2 py-1 bg-blue-50 text-blue-600 text-xs rounded">待审批</span>
                            <h3 id="approvalTaskName" class="text-lg font-bold text-slate-800">技术方案审核任务</h3>
                        </div>
                        <div id="approvalTaskId" class="text-sm text-slate-400 mb-6">任务ID: 202601140001</div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">任务信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务状态</span>
                                        <span id="approvalTaskStatus" class="font-medium text-blue-600">待审批</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">任务时限</span>
                                        <span id="approvalDuration" class="font-medium text-slate-800">3天</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">截止时间</span>
                                        <span id="approvalDeadline" class="font-medium text-slate-800">2026/01/24</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">支持信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心</span>
                                        <span id="approvalSupportCenter" class="font-medium text-slate-800">技术中心</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">支持中心人员</span>
                                        <span id="approvalAssignee" class="font-medium text-slate-800">王总工</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">联系方式</span>
                                        <span class="font-medium text-slate-800">138****5678</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">进度信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">完成进度</span>
                                        <span id="approvalProgress" class="font-medium text-slate-800">0%</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报人员</span>
                                        <span class="font-medium text-slate-800">张经理</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">提报项目</span>
                                        <span class="font-medium text-slate-800">机场T3航站楼项目</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-amber-50 p-4 rounded-lg">
                                <h4 class="text-xs font-bold text-slate-500 mb-2">审批信息</h4>
                                <div class="space-y-1 text-sm">
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">审批人</span>
                                        <span id="approverName" class="font-medium text-slate-800">张经理</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">审批时间</span>
                                        <span id="approvalTime" class="font-medium text-slate-800">2026/01/21 15:30</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <span class="text-slate-600">审批状态</span>
                                        <span class="font-medium text-slate-800">待审批</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-slate-700 mb-3">内容描述</h4>
                            <div class="p-4 bg-slate-50 border border-slate-100 rounded-lg text-sm text-slate-700 leading-relaxed">
                                完成技术方案审核任务，确保方案符合规范要求，满足项目需要，并在3天内完成所有工作。
                            </div>
                        </div>

                        <!-- 审批选项 -->
                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-slate-700 mb-3">审批选项</h4>
                            <div class="p-4 bg-slate-50 border border-slate-100 rounded-lg">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-slate-600 mb-3">审批结果</label>
                                    <div class="flex gap-4">
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="radio" name="approvalResult" value="approve" class="w-4 h-4 text-indigo-600">
                                            <span class="text-sm text-slate-700">审批通过</span>
                                        </label>
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="radio" name="approvalResult" value="reject" class="w-4 h-4 text-indigo-600">
                                            <span class="text-sm text-slate-700">审批不通过</span>
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-600 mb-2">意见说明</label>
                                    <textarea rows="4" class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-100" placeholder="请输入审批意见..." id="approvalComment"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- 工单操作记录 -->
                        <div>
                            <h4 class="text-sm font-bold text-slate-700 mb-3">工单操作记录</h4>
                            <div class="space-y-4">
                                <div class="flex items-start gap-3">
                                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="check-circle" class="w-4 h-4 text-indigo-600"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center mb-1">
                                            <h5 class="text-sm font-medium text-slate-800">任务创建</h5>
                                            <span class="text-xs text-slate-400">2026/01/14 10:00</span>
                                        </div>
                                        <p class="text-xs text-slate-600">张经理创建了技术方案审核任务</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="user-plus" class="w-4 h-4 text-indigo-600"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center mb-1">
                                            <h5 class="text-sm font-medium text-slate-800">任务分配</h5>
                                            <span class="text-xs text-slate-400">2026/01/14 10:30</span>
                                        </div>
                                        <p class="text-xs text-slate-600">任务分配给王总工</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="clock" class="w-4 h-4 text-slate-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center mb-1">
                                            <h5 class="text-sm font-medium text-slate-800">等待审批</h5>
                                            <span class="text-xs text-slate-400">2026/01/14 10:30</span>
                                        </div>
                                        <p class="text-xs text-slate-600">任务已分配，等待审批</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </main>

    <script>
        // 初始化 Lucide 图标
        lucide.createIcons();

        // 导航函数
        function navigateTo(page) {
            window.location.href = page;
        }

        // 组织菜单切换
        function toggleOrgMenu() {
            const orgMenu = document.getElementById('orgMenu');
            orgMenu.classList.toggle('hidden');
        }

        // 切换组织
        function changeOrg(orgName) {
            document.getElementById('currentOrg').textContent = orgName;
            toggleOrgMenu();
        }

        // 切换中心视图
        function switchCenterView(centerName, element) {
            // 移除所有活动状态
            document.querySelectorAll('.center-nav').forEach(item => {
                item.classList.remove('active');
            });
            
            // 添加活动状态到当前元素
            if (element) {
                element.classList.add('active');
            }
            
            // 更新中心徽章
            const centerBadge = document.getElementById('centerBadge');
            if (centerBadge) {
                centerBadge.textContent = centerName;
                
                // 根据中心设置不同颜色
                const colorMap = {
                    '总包中心': 'bg-blue-100 text-blue-700',
                    '设计中心': 'bg-purple-100 text-purple-700',
                    '技术中心': 'bg-emerald-100 text-emerald-700',
                    '商务中心': 'bg-orange-100 text-orange-700',
                    '供应链中心': 'bg-cyan-100 text-cyan-700'
                };
                
                // 移除所有颜色类
                centerBadge.className = 'px-2 py-0.5 text-xs rounded-full font-bold';
                
                // 添加对应颜色类
                if (colorMap[centerName]) {
                    centerBadge.classList.add(...colorMap[centerName].split(' '));
                }
            }
        }

        // 打开个人任务中心
        function openPersonalTaskCenter() {
            alert('打开个人任务中心');
        }

        // 打开任务提报
        function openTaskReport() {
            switchPage('task-report');
        }

        // 切换子任务显示
        function toggleSubtasks(taskId) {
            const subtasks = document.getElementById(taskId + 'Subtasks');
            const icon = document.getElementById(taskId + 'Icon');
            
            if (subtasks) {
                subtasks.classList.toggle('hidden');
                
                if (icon) {
                    if (subtasks.classList.contains('hidden')) {
                        icon.style.transform = 'rotate(0deg)';
                    } else {
                        icon.style.transform = 'rotate(180deg)';
                    }
                }
            }
        }

        // 切换页面
        function switchPage(pageId) {
            // 隐藏所有页面
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // 显示目标页面
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // 更新导航选中状态
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            if (document.getElementById('nav-' + pageId)) {
                document.getElementById('nav-' + pageId).classList.add('active');
            }
            
            // 更新页面标题
            const pageTitles = {
                'tasks': '任务大厅',
                'task-report': '任务提报',
                'task-detail': '任务详情',
                'todo-detail': '待办详情'
            };
            document.getElementById('pageTitle').textContent = pageTitles[pageId] || '任务大厅';
        }

        // 保存任务草稿
        function saveTaskDraft() {
            // 模拟保存草稿功能
            alert('任务已保存为草稿');
        }

        // 提交任务报告
        function submitTaskReport() {
            // 模拟提交任务功能
            alert('任务已提交审批');
        }

        // 撤回任务
        function withdrawTask() {
            // 模拟撤回任务功能
            alert('任务已撤回');
        }

        // 废弃任务
        function abandonTask() {
            // 模拟废弃任务功能
            alert('任务已废弃');
        }
    </script>

</body>
</html>